import{r as E}from"./request-_vMSyIZd.js";import{p as L,d as b,r as o,m as D,z as S,C as y,c as f,e as l,x as k,F as V,D as B,E as C,G as N,w as F,b as I,f as M,o as v,y as $,_ as j}from"./index-Bs1UhSfa.js";import{A as q}from"./ArticleItem-brkvoHK1.js";import"./tupian-CkFRL8Gn.js";function x(p){return E.get("/h5/interview/query",{headers:{Authorization:L()},params:p})}const G={class:"home-view"},P={class:"my-nav van-hairline--bottom"},U={class:"article-list"},J={class:"load-more"},K={key:1,class:"no-more"},O=b({__name:"HomeView",setup(p){const a=o([]),n=o([]),i=o(!1),c=o(1),g=o(10),d=o(0),s=o(!1),r=o(!1),H=(e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime(),w=()=>[...a.value].sort(H),h=e=>{i.value=e,i.value?n.value=w():n.value=[...a.value]},T=async()=>{try{c.value=1,s.value=!0,r.value=!1;const e=await x({current:c.value,pageSize:g.value});a.value=e.data.data.rows,d.value=e.data.data.total,n.value=[...a.value],a.value.length>=d.value&&(r.value=!0)}catch(e){y("获取数据失败，请稍后重试"),console.error("获取数据失败:",e)}finally{s.value=!1}};D(async()=>{await T(),window.addEventListener("scroll",_)}),S(()=>{window.removeEventListener("scroll",_)});const _=()=>{const e=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.clientHeight||window.innerHeight,m=document.documentElement.scrollHeight||document.body.scrollHeight;e+t>=m-200&&!s.value&&!r.value&&z()},z=async()=>{if(!(s.value||r.value))try{s.value=!0,c.value++;const e=await x({current:c.value,pageSize:g.value}),t=e.data.data.rows;d.value=e.data.data.total,a.value.push(...t),i.value?n.value=w():n.value=[...a.value],a.value.length>=d.value&&(r.value=!0)}catch(e){y("加载更多失败，请稍后重试"),console.error("加载更多失败:",e),c.value--}finally{s.value=!1}},A=e=>{$.push({name:"article",params:{id:e}})};return(e,t)=>{const m=I("van-loading");return v(),f("div",G,[l("nav",P,[l("a",{class:k({active:!i.value}),href:"javascript:;",onClick:t[0]||(t[0]=u=>h(!1))},"推荐",2),l("a",{class:k({active:i.value}),href:"javascript:;",onClick:t[1]||(t[1]=u=>h(!0))},"最新",2),t[2]||(t[2]=l("div",{class:"logo"},[l("h1",{class:"logo-text"},"面经")],-1))]),l("div",U,[(v(!0),f(V,null,B(n.value,u=>(v(),C(q,{key:u.id,item:u,onClick:Q=>A(u.id)},null,8,["item","onClick"]))),128))]),l("div",J,[s.value?(v(),C(m,{key:0,size:"20px",color:"#999",vertical:""},{default:F(()=>[...t[3]||(t[3]=[M(" 加载中... ",-1)])]),_:1})):r.value?(v(),f("span",K,"没有更多数据了")):N("",!0)])])}}}),Z=j(O,[["__scopeId","data-v-18bf9ae9"]]);export{Z as default};
