import{_ as F}from"./tupian-CkFRL8Gn.js";import{j as L,r as v,k as m,l,d as O,m as z,n as T,p as g,q as x,c as B,a as q,e as o,b as I,t as r,v as C,x as b,o as N,y as V}from"./index-Bs1UhSfa.js";import{r as p}from"./request-_vMSyIZd.js";const j="/mianjing/assets/shoucang-CgyUguqL.png",H="/mianjing/assets/dianzan-CWVvXbiA.png",M=L("counter",()=>{const u=v(0),t=m(()=>u.value*2);function d(){u.value++}const e=v(!1),n=v(!1);function f(){e.value?l("取消收藏"):l("收藏成功"),e.value=!e.value}function k(){n.value?l("取消点赞"):l("点赞成功"),n.value=!n.value}return{count:u,doubleCount:t,increment:d,click1:e,click2:n,onOffsetChange1:f,onOffsetChange2:k}}),$={class:"article-container"},D={class:"stem"},P={class:"foot"},U={class:"article-content"},E={class:"head"},R={class:"con"},W={class:"title"},X={class:"other"},G=["innerHTML"],J={class:"contain"},Z=O({__name:"ArticleView",setup(u){const t=M(),d=T(),e=v({});z(async()=>{const s="?id="+d.params.id,a=await p.get(`/h5/interview/show${s}`,{headers:{Authorization:g()}});e.value=a.data.data,console.log(e.value),e.value.likeFlag===1?t.click2=!0:t.click2=!1,e.value.collectFlag===1?t.click1=!0:t.click1=!1,e.value&&e.value.id&&x({id:e.value.id,title:e.value.stem,createdAt:e.value.createdAt,viewedAt:new Date().toISOString(),path:`/article/${e.value.id}`})});const n=()=>{V.back()},f=async()=>{(await p.post("/h5/interview/opt",{optType:2,id:e.value.id},{headers:{Authorization:g()}})).data.code===1e4?(t.onOffsetChange1(),e.value.collectFlag=t.click1?1:0):l("收藏失败")},k=async()=>{const s=e.value.likeCount,a=e.value.likeFlag,i=t.click2;t.onOffsetChange2(),t.click2?(e.value.likeCount=Number(e.value.likeCount)+1,e.value.likeFlag=1):(e.value.likeCount=Number(e.value.likeCount)-1,e.value.likeFlag=0),console.log("UI更新后点赞数:",e.value.likeCount);try{const c=await p.post("/h5/interview/opt",{optType:1,id:e.value.id},{headers:{Authorization:g()}});console.log("API响应:",c),c.data.code!==1e4&&(console.error("点赞API返回错误码:",c.data.code),l("点赞失败: "+c.data.message),_(s,a,i))}catch(c){console.error("点赞请求异常:",c),l("网络错误，请稍后重试"),_(s,a,i)}},_=(s,a,i)=>{e.value.likeCount=s,e.value.likeFlag=a,t.click2=i,console.log("状态已回滚，点赞数:",e.value.likeCount)},y=m(()=>t.click1),w=m(()=>t.click2),A={y:40},S={y:40},h=s=>({position:"relative",marginBottom:`${s.y}px`});return(s,a)=>{const i=I("van-nav-bar");return N(),B("div",$,[q(i,{title:"面经详情","left-text":"返回","left-arrow":"",onClickLeft:n}),o("div",D,r(e.value.stem),1),o("div",P,"点赞 "+r(e.value.likeCount)+" | 浏览 "+r(e.value.views),1),o("div",U,[o("div",E,[a[0]||(a[0]=o("img",{src:F,alt:""},null,-1)),o("div",R,[o("p",W,r(e.value.creator),1),o("p",X,r(e.value.createdAt),1)])]),o("div",{class:"body",innerHTML:e.value.content},null,8,G)]),o("span",J,[o("div",{class:b(["floating-bubble",y.value?"fo2":"fo1"]),style:C(h(A)),onClick:f},[...a[1]||(a[1]=[o("img",{src:j,alt:"收藏",class:"bubble-icon"},null,-1)])],6),o("div",{class:b(["floating-bubble",w.value?"fo2":"fo1"]),style:C(h(S)),onClick:k},[...a[2]||(a[2]=[o("img",{src:H,alt:"点赞",class:"bubble-icon"},null,-1)])],6)])])}}});export{Z as default};
